!function(a){"use strict";var b,c;b=function(){this.frames=[],this.watchForiFrames()},b.prototype={findAndProcessIframes:function(){var b,c=a.getElementsByTagName("iframe");for(b=0;b<c.length;++b)this.frames.push(c[b]),this.processiFrame(c[b])},processiFrame:function(b){var c,d,e=b.dataset||{setSrc:b.getAttribute("data-set-src"),relaySearch:b.getAttribute("data-relay-search"),relayHash:b.getAttribute("data-relay-hash")},f="true"===(e.relaySearch||"").toLocaleLowerCase(),g="true"===(e.relayHash||"").toLocaleLowerCase();e.setSrc&&(c=e.setSrc,d=c.split("#"),f&&a.location.search&&(a.location.search&&c.indexOf("?")!==-1?d[0]=d[0]+"&"+a.location.search.substr(1,a.location.search.length):d[0]=d[0]+a.location.search),g&&a.location.hash?d[1]=a.location.hash:d[1]&&(d[1]="#"+d[1]),c=d.join(""),setTimeout(b.setAttribute.bind(b,"src",c),3))},watchForiFrames:function(){var b;return window.MutationObserver?(this.findAndProcessIframes(),b=new window.MutationObserver(this.onMutation.bind(this)),void b.observe(document,{childList:!0,subtree:!0})):(window.console.warn("Browser does not support MutationObserver - cannot watch for iframes"),void a.addEventListener("DOMContentLoaded",this.findAndProcessIframes.bind(this)))},onMutation:function(a){a.forEach(function(a){var b,c;for(c=0;c<a.addedNodes.length;c++)b=a.addedNodes[c],b&&"IFRAME"===b.tagName&&this.frames.indexOf(b)===-1&&(this.frames.push(b),this.processiFrame(b));for(c=0;c<a.removedNodes.length;c++)b=a.removedNodes[c],b&&"IFRAME"===b.tagName&&this.frames.splice(this.frames.indexOf(b),1)},this)}},c=function(){if(b.call(this),this.intervalMS=250,this.oldHeight=-1,this.heightChangeCallbacks=[],this.watchHeightIntervalID=null,this.isTopFrame=window===window.parent,this.sendJson=this.isJsonRequired(),this.initResponsiveFrame(),window.scrollTo===this.scrollToIntercept)throw"ResponsiveFrame appears to be init twice - cannot alias scroll to more then once"},c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.msgTypes={childHeightChanged:"childHeightChanged"},c.prototype.onScrollTo=function(a,b){this.oldHeight=-1,this.checkHeightChange()},c.prototype.isJsonRequired=function(){var a=!1;try{window.parent.postMessage({toString:function(){return a=!0,"json required test"}},"*")}catch(a){}return a},c.prototype.initResponsiveFrame=function(){window.addEventListener?window.addEventListener("message",this.handleMessage.bind(this),!1):window.attachEvent("onmessage",this.handleMessage.bind(this),!1),this.isTopFrame||this.onHeightChange(this.sendHeightToParent.bind(this))},c.prototype.onHeightChange=function(a){this.heightChangeCallbacks.push(a),null===this.watchHeightIntervalID&&(this.watchHeightIntervalID=window.setInterval(this.checkHeightChange.bind(this),this.intervalMS))},c.prototype.clearOnHeightChange=function(){window.clearInterval(this.watchHeightIntervalID),this.heightChangeCallbacks=[]},c.prototype.sendHeightToParent=function(a){var b={msgType:this.msgTypes.childHeightChanged,height:a.height,oldHeight:a.oldHeight};window.parent.postMessage(this.sendJson?JSON.stringify(b):b,"*")},c.prototype.handleMessage=function(a){var b,c,d,e,f,g,h=a.source,i=a.data;if(h!==window.parent){if(this.sendJson)try{i=JSON.parse(i)}catch(a){return void window.console.warn("Cannot parse message data: ",i)}e=i.msgType,e===this.msgTypes.childHeightChanged&&(c=this.findFrameFromSource(h),c&&(f=i.height,g=i.oldHeight,d=c.dataset||{responsive:c.getAttribute("data-responsive")},b="true"===(d.responsive||"").toLocaleLowerCase(),b&&(c.style.height=i.height+"px",c.setAttribute("scrolling","no"),c.dataset||(c.dataset={}),g===-1&&"yes"===c.dataset.responsiveReceiving?this.ensureElementInView(c):g===-1&&setTimeout(function(){c.dataset.responsiveReceiving="yes"},2e3))))}},c.prototype.ensureElementInView=function(a){var b=80,c=150,d=a.getBoundingClientRect().top,e=window.scrollY,f=e+window.innerHeight-c;d<e&&d>f||window.scrollTo(window.scrollX,Math.max(d-b,0))},c.prototype.findFrameFromSource=function(b){var c,d,e=this.frames||a.getElementsByTagName("iframe");for(c=0;c<e.length;++c)if(d=e[c],d.contentWindow===b)return d;return null},c.prototype.checkHeightChange=function(){var a=this.getHeight(),b=a===this.oldHeight?null:a;null!==b&&(this.triggerHeightChangeCallbacks({height:b,oldHeight:this.oldHeight}),this.oldHeight=b)},c.prototype.triggerHeightChangeCallbacks=function(a){this.heightChangeCallbacks.forEach(function(b){b(a)})},c.prototype.getHeight=function(){var b,a=document.body;return document.body.style.height="auto",b=document.body.offsetHeight,b+=parseInt(window.getComputedStyle(a).getPropertyValue("margin-top")),b+=parseInt(window.getComputedStyle(a).getPropertyValue("margin-bottom")),window.navigator.userAgent.indexOf("MSIE")!==-1?b+45:b};var d=new c,e=window.scrollTo;window.scrollTo=function(a,b){0==b&&d.onScrollTo(a,b),e(a,b)}}(document);